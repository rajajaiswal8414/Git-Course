import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable, of, catchError } from 'rxjs';
import { MedicalRecordResponseDTO } from '../../models/medicalrecord-interface';

@Injectable({
  providedIn: 'root',
})
export class MedicalRecordService {
  private baseUrl = '/api';
  private useMockData = false; // Use real backend

  constructor(private http: HttpClient) {}

  getRecordsForPatient(): Observable<MedicalRecordResponseDTO[]> {
    if (this.useMockData) {
      return of(this.getMockMedicalRecords());
    }
    
    return this.http.get<MedicalRecordResponseDTO[]>(`${this.baseUrl}/patients/me/medical-records`).pipe(
      catchError(() => of(this.getMockMedicalRecords()))
    );
  }

  private getMockMedicalRecords(): MedicalRecordResponseDTO[] {
    return [
      {
        recordId: 1,
        patientId: 1,
        doctorId: 1,
        patientName: 'John Doe',
        doctorName: 'Dr. Sarah Johnson',
        reason: 'Regular checkup',
        diagnosis: 'Hypertension',
        notes: 'Patient responding well to medication. Blood pressure under control.',
        prescriptions: [
          {
            prescriptionId: 1,
            medicationName: 'Lisinopril',
            dosage: '10mg',
            instructions: 'Take once daily with food',
            prescribedAt: '2024-01-15T10:00:00Z'
          }
        ],
        createdAt: '2024-01-15T10:00:00Z'
      },
      {
        recordId: 2,
        patientId: 1,
        doctorId: 2,
        patientName: 'John Doe',
        doctorName: 'Dr. Michael Brown',
        reason: 'Headache consultation',
        diagnosis: 'Migraine',
        notes: 'Patient reports reduced frequency of headaches. Continue current treatment.',
        prescriptions: [
          {
            prescriptionId: 2,
            medicationName: 'Sumatriptan',
            dosage: '50mg',
            instructions: 'Take as needed for migraine attacks',
            prescribedAt: '2024-01-10T14:30:00Z'
          }
        ],
        createdAt: '2024-01-10T14:30:00Z'
      }
    ];
  }
}



      import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable, of, catchError } from 'rxjs';
import { NotificationResponseDTO } from '../../models/notification-interface';

@Injectable({
  providedIn: 'root',
})
export class NotificationService {
  private baseUrl = '/api';
  private useMockData = false; // Use real backend

  constructor(private http: HttpClient) {}

  getPatientNotifications(): Observable<NotificationResponseDTO[]> {
    if (this.useMockData) {
      return of(this.getMockNotifications());
    }
    
    return this.http.get<NotificationResponseDTO[]>(`${this.baseUrl}/patients/me/notifications`).pipe(
      catchError(() => of(this.getMockNotifications()))
    );
  }

  markAsRead(notificationId: number): Observable<void> {
    if (this.useMockData) {
      return of();
    }
    
    return this.http.put<void>(`${this.baseUrl}/${notificationId}/read`, {}).pipe(
      catchError(() => of())
    );
  }

  markAllAsRead(): Observable<void> {
    if (this.useMockData) {
      return of();
    }
    
    return this.http.put<void>(`${this.baseUrl}/notifications/read-all`, {}).pipe(
      catchError(() => of())
    );
  }

  private getMockNotifications(): NotificationResponseDTO[] {
    return [
      {
        id: 1,
        appointmentId: 1,
        recipientType: 'PATIENT',
        recipientId: 1,
        title: 'Appointment Confirmed',
        message: 'Your appointment with Dr. Sarah Johnson on January 20th at 9:00 AM has been confirmed.',
        read: false,
        createdAt: '2024-01-15T10:30:00Z'
      },
      {
        id: 2,
        appointmentId: 2,
        recipientType: 'PATIENT',
        recipientId: 1,
        title: 'Prescription Ready',
        message: 'Your prescription for Lisinopril is ready for pickup at the pharmacy.',
        read: false,
        createdAt: '2024-01-14T14:20:00Z'
      },
      {
        id: 3,
        appointmentId: 0,
        recipientType: 'PATIENT',
        recipientId: 1,
        title: 'Test Results Available',
        message: 'Your recent blood test results are now available in your medical records.',
        read: true,
        createdAt: '2024-01-12T09:15:00Z'
      }
    ];
  }
}


      import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { AppointmentDTO, AppointmentResponseDTO } from '../../models/appointment-interface';
import { environment } from '../../environments/environment';
import { DoctorResponseDTO } from '../../models/doctor-interface';
import { Patient } from '../../models/patient-interface';

@Injectable({
  providedIn: 'root',
})
export class AppointmentService {
  private api = environment.apiUrl; // http://localhost:8080/api

  constructor(private http: HttpClient) {}

  bookAppointment(appointmentDTO: AppointmentDTO): Observable<AppointmentResponseDTO> {
    return this.http.post<AppointmentResponseDTO>(
      `${this.api}${environment.patient.addAppointments}`,
      appointmentDTO
    );
  }

  getAppointmentsForPatient(): Observable<AppointmentResponseDTO[]> {
    return this.http.get<AppointmentResponseDTO[]>(
      `${this.api}${environment.patient.getAppointments}`
    );
  }

  getAppointmentById(appointmentId: number): Observable<AppointmentResponseDTO> {
    return this.http.get<AppointmentResponseDTO>(`${this.api}/appointments/${appointmentId}`);
  }

  updateAppointment(
    appointmentId: number,
    appointmentDTO: AppointmentDTO
  ): Observable<AppointmentResponseDTO> {
    return this.http.patch<AppointmentResponseDTO>(
      `${this.api}${environment.patient.updateAppointment.replace(
        '{appointmentId}',
        String(appointmentId)
      )}`,
      appointmentDTO
    );
  }

  cancelAppointment(appointmentId: number): Observable<AppointmentResponseDTO> {
    return this.http.patch<AppointmentResponseDTO>(
      `${this.api}${environment.patient.cancelAppointment.replace(
        '{appointmentId}',
        String(appointmentId)
      )}`,
      {}
    );
  }

  // Doctor: get own appointments
  getAppointmentsForDoctor(): Observable<AppointmentResponseDTO[]> {
    return this.http.get<AppointmentResponseDTO[]>(`${this.api}/doctors/me/appointments`);
  }
}




      import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable, of, catchError } from 'rxjs';
import { Patient, PatientDTO } from '../../models/patient-interface';
import { DoctorResponseDTO } from '../../models/doctor-interface';

@Injectable({
  providedIn: 'root',
})
export class PatientService {
  private baseUrl = '/api/patients';
  private useMockData = false; // Use real backend

  constructor(private http: HttpClient) {}

  getPatient(): Observable<Patient> {
    if (this.useMockData) {
      return of(this.getMockPatient());
    }
    
    return this.http.get<Patient>(`${this.baseUrl}/me`).pipe(
      catchError(() => of(this.getMockPatient()))
    );
  }

  updatePatient(patientDTO: PatientDTO): Observable<Patient> {
    if (this.useMockData) {
      return of(this.getMockPatient());
    }
    
    return this.http.patch<Patient>(`${this.baseUrl}/me`, patientDTO).pipe(
      catchError(() => of(this.getMockPatient()))
    );
  }

  searchDoctorByName(name: string): Observable<DoctorResponseDTO[]> {
    if (this.useMockData) {
      return of(this.getMockDoctors().filter(doctor => 
        doctor.doctorName.toLowerCase().includes(name.toLowerCase())
      ));
    }
    
    return this.http.get<DoctorResponseDTO[]>(`${this.baseUrl}/doctor-name?name=${name}`).pipe(
      catchError(() => of(this.getMockDoctors().filter(doctor => 
        doctor.doctorName.toLowerCase().includes(name.toLowerCase())
      )))
    );
  }

  searchDoctorBySpecialization(specialization: string): Observable<DoctorResponseDTO[]> {
    if (this.useMockData) {
      return of(this.getMockDoctors().filter(doctor => 
        doctor.specialization.toLowerCase().includes(specialization.toLowerCase())
      ));
    }
    
    return this.http.get<DoctorResponseDTO[]>(
      `${this.baseUrl}/doctor-specialization?specialization=${specialization}`
    ).pipe(
      catchError(() => of(this.getMockDoctors().filter(doctor => 
        doctor.specialization.toLowerCase().includes(specialization.toLowerCase())
      )))
    );
  }

  getAllDoctors(): Observable<DoctorResponseDTO[]> {
    if (this.useMockData) {
      return of(this.getMockDoctors());
    }
    
    return this.http.get<DoctorResponseDTO[]>(`${this.baseUrl}/all-doctors`).pipe(
      catchError(() => of(this.getMockDoctors()))
    );
  }

  private getMockPatient(): Patient {
    return {
      patientId: 1,
      name: 'John Doe',
      email: 'john.doe@email.com',
      contactNumber: '+1-555-0123',
      address: '123 Main St, City, State',
      gender: 'Male',
      dateOfBirth: '1990-01-01',
      bloodGroup: 'O+'
    };
  }

  private getMockDoctors(): DoctorResponseDTO[] {
    return [
      {
        doctorId: 1,
        doctorName: 'Dr. Sarah Johnson',
        specialization: 'Cardiology',
        contactNumber: '+1-555-0101',
        email: 'sarah.johnson@hospital.com',
        address: '123 Medical Center, City, State',
        licenseNumber: 'MD123456',
        yearsOfExperience: 10,
        consultationFee: 150
      },
      {
        doctorId: 2,
        doctorName: 'Dr. Michael Brown',
        specialization: 'Neurology',
        contactNumber: '+1-555-0102',
        email: 'michael.brown@hospital.com',
        address: '456 Health Plaza, City, State',
        licenseNumber: 'MD123457',
        yearsOfExperience: 8,
        consultationFee: 175
      },
      {
        doctorId: 3,
        doctorName: 'Dr. Emily Davis',
        specialization: 'Pediatrics',
        contactNumber: '+1-555-0103',
        email: 'emily.davis@hospital.com',
        address: '789 Children Hospital, City, State',
        licenseNumber: 'MD123458',
        yearsOfExperience: 12,
        consultationFee: 125
      },
      {
        doctorId: 4,
        doctorName: 'Dr. Robert Wilson',
        specialization: 'General Medicine',
        contactNumber: '+1-555-0104',
        email: 'robert.wilson@hospital.com',
        address: '321 Family Clinic, City, State',
        licenseNumber: 'MD123459',
        yearsOfExperience: 15,
        consultationFee: 100
      }
    ];
  }
}
